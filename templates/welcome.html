{% extends 'base.html' %}
{% block content %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvOEtQIfXWSZq8tKg2S2RrHhOkikKxcY0&callback=initialize" async defer></script>
<script src="/static/javascript/geocode.js"></script>

<div id="pick_by_state">
<form id="state_pick" method="post" action="/state_info.json">
 
  <label> Pick a state:</label>
    <select name="state" id="state_value">
    	<option> Choose a State </option>
    {% for state in states %}
      <option value="{{ state[0] }}"> {{ state[1] }} </option>
    {% endfor %}  
</select>
</form>

<div id="legislators_display" style="display: none;"> 

<h2> Pick a Member to Map </h2>

<form id="member_list" method="get" action='/trail_map'> 
	<label>Select a Member of Congress: </label>
	
	<select name="member" id="member_choice">


<input type="submit" id="submit_member" value="Map this Member">
</form>
</div>
</div>

<div id="pick_by_address"> OR 
	<form>
	<label>Enter Address to Find Your Members:</label>
		<input id="address" type="textbox">
		<input type="submit" id="submit_geocode" value="Find My Members of Congress">
	</form>

<div id="your_district_reps"> </div>	

<script>


// use Ajax to get show dropdown of the legislators from the selected state
function showLegislators(evt) {

	evt.preventDefault();
	$('#member_choice option').remove();
	$('#your_district_reps').html();
	//post request takes a dictionary so send key/value pair of the key I want to get 
	state_value = {'state_value': $("#state_value").val()};

	//ajax that sends the state selected and gets back the json values id'd on server.
	//parse and put into the dropdown menu. assigning the leg_id to the value of the selection so can grab that on server side to query for contribution information.

	$.post("/state_info", state_value, function (result) {
			console.log(result)
			console.log(result.representatives)
			console.log(result.representatives.length)

		if (result.senators) {
			$('#member_choice').append("<option class=chamber_label>" + "Senators" +"</option>");
			
			for (var i in result.senators) {$('#member_choice').append($("<option class=senate></option>").val(result.senators[i].leg_id).text(result.senators[i].title + ". " + result.senators[i].first + " " + result.senators[i].last + " (" + result.senators[i].party + ")")); }
		}
		
		// empty seats
		
		if (result.representatives.length > 0) {
			$('#member_choice').append("<option class=chamber_label>" + "House Members" +"</option>");
			
			var representatives = result.representatives
			
			// thanks stack overflow
			function SortByDistrict(a, b){
			  var aDist = a.district;
			  var bDist= b.district; 
			  return ((aDist < bDist) ? -1 : ((aDist > bDist) ? 1 : 0));
			};

			var sorted_reps = representatives.sort(SortByDistrict);

			// define special case for at-large (no district, only house member)
			for (var i in sorted_reps){
				if (sorted_reps[i].district === 0) {
					district = " - At-Large"
				} else {
					district = " - " + sorted_reps[i].district
				};
					
				// cycle through list of representatives returned, to pull relevant info out & put in drop-down menu
				
				$('#member_choice').append($("<option class=house></option>").val(sorted_reps[i].leg_id).text(sorted_reps[i].title + ". " + sorted_reps[i].first + " " + sorted_reps[i].last + " (" + sorted_reps[i].party + district + ")")); 

				};
		} else {
			$('#your_district_reps').html("Sorry, that seat is vacant")
		}

		});
		
		$("#legislators_display").show();

	}

//list possible representatives only after choose state.	
$("#state_pick").change("state_value", showLegislators);


</script>
{% endblock %}