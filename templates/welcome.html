{% extends 'base.html' %}
{% block content %}
<script src="https://code.jquery.com/jquery.js"></script>

<form id="state_pick" method="post" action="/state_info.json">
 
  <label> Pick a state:</label>
    <select name="state" id="state_value">

    {% for state in states %}
      <option value="{{ state[0] }}"> {{ state[1] }} </option>
    {% endfor %}  
</select>
<input type="submit" id="submit_state">
</form>

<div id="legislators_display" style="display: none;"> 

<h2> Pick a Member to Map </h2>

<form display='none' id="member_list" method="get" action='/trail_map'> 
	<label>Pick a Member of Congress: </label>
	
	<select name="member" id="member_choice">
		<option >Senators</option>
		<option id="sen1"> </option>
		<option id="sen2"> </option>
		<option>House Members </option>


<input type="submit" id="submit_member">
</form>
</div>

<script>
// TODO: figure out how to make this work!
// use Ajax to get show the legislators from the selected state
function showLegislators(evt) {

	evt.preventDefault();
	
	state_value = {'state_value': $("#state_value").val()};

	$.post("/state_info", state_value, function (result) {
			$("#sen1").attr("value", result.senator1.leg_id).html(result.senator1.title + ". " + result.senator1.first + " " +result.senator1.last + " (" + result.senator1.party +")");

			$("#sen2").attr("value", result.senator2.leg_id).html(result.senator2.title + ". " + result.senator2.first + " " +result.senator2.last + " (" + result.senator2.party +")");

		// cycle through list of members returned, to pull relevant info out.	
			for (var i in result.members){
				if (result.members[i].district === 0) {
					district = " At-Large"
				} else {
					district = " - " + result.members[i].district
				};
				
				$("#member_choice").append("<option value=" + result.members[i].leg_id + ">" + result.members[i].title + ". " + result.members[i].first + " " +result.members[i].last + " (" + result.members[i].party + district + ")" + "</option>")
			};

			$("#legislators_display").show();

		});
	}
$("#state_pick").on("submit", showLegislators);
</script>
{% endblock %}