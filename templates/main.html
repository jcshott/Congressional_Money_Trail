{% extends 'base.html' %}
{% block content %}

<link rel="stylesheet" href="/static/css/main.css">
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvOEtQIfXWSZq8tKg2S2RrHhOkikKxcY0&callback=initialize" async defer></script>
<script src="/static/javascript/get_members.js"></script>

	<!-- <div class="navbar navbar-default navbar-static-top"> -->
		<!-- <div class="container"> -->
		
		<!-- Large modal button -->
		<!-- <button type="button" class="btn btn-default" data-toggle="modal" data-target=".modal-info">Click for info on data</button> -->

<!-- 		<button type="button" id="popover" class="btn btn-default" style="display: none;" data-container="body" data-toggle="popover" data-placement="bottom" data-content="You are looking at a visualization of campaign contributions for the Member of Congress shown on the left.  First you'll see the distribution how much the Member of Congress recieved from Political Action Committess (PACs) v. Individual donors.  Hover on a node to see more information and click on the nodes to follow the trail - the end will show the Top 10 Individual or PAC contributors.">
		  What am I seeing?
		</button> -->

	    <!-- <div class="navbar-collapse collapse"> -->
		    <!-- <ul class="nav navbar-nav navbar-right"> -->
		        <!-- <li> -->
		            <!-- Share page on twitter button -->

		        <!-- </li> -->
		    <!-- </ul> -->
	    <!-- </div> -->
		<!-- </div> -->
	<!-- </div> -->

<div class="container-fluid">

	<div class="row main">
		<div class="col-md-2" id="sidebar">

				<div id="twitterButton">  
<!-- 					Share page on twitter button -->
						<a href="https://twitter.com/share" class="twitter-share-button" data-text="See where your federal representatives get their campaign money" data-via="jcshott" data-size="large" data-count="none" data-hashtags="FollowTheMoneyTrail,Congress">Tweet</a>

						<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>

				<div class="row forms">
					<div class="form-group">
						<form id="state_pick" method="post" action="/state_info.json">
						 
						  <label> Pick a state:</label>
						    <select class="form-control" name="state" id="state_value">
						    	<option> Choose a State </option>
						    {% for state in states %}
						      <option value="{{ state[0] }}"> {{ state[1] }} </option>
						    {% endfor %}  
						</select>
						</form>
					</div>
					
					<div id="legislators_display" class="form-group" style="display: none;"> 

						<h2> Pick a Member to Map </h2>

						<form class='repsDistrict' method="get" action='/trail_map'> 
							<label>Select a Member of Congress: </label>
							
							<select name="member" class="member_choice form-control" id="member_list">


							<input type="submit" class="btn btn-default" id="submit_member" value="Map this Member">
						</form>
					</div>

					<div id="noMember" style="display: none;">Sorry, that seat is currently vacant or there is no data currently available for that Member of Congress. Please choose another state or enter an address
					</div>

					<!-- find members by address form -->
					<div id="pick_by_address" class="form-group"> 
						<form>
							<label> Enter Address to Find Your Congressional Delegation </label>
							<input id="address" type="textbox" class="form-control" placeholder="Address">
							<input type="submit" class="btn btn-default" id="submit_geocode" value="Find My Delegation">
						</form>
					</div>


					<div id="your_district_reps" class="form-group" style="display: none;"> 
						<form class='repsDistrict' method="get" action='/trail_map'> 
							<label id="repsByAddress"> </label>
						
							<select name="member" class="member_choice form-control" id="address_member_list">
							
							<input type="submit" class="btn btn-default" id="submit_member" value="Map this Member">
						</form>

					</div>
				</div>
				
				<div class="row member_profile"></div>

				<div class="row new_member">

				 	<button type="button" class="btn btn-default" id="new_choice" style="display: none;">Map a new legislator </button> 
				</div>
			

			</div>


		<div id="map_viz" class="col-md-10" style="display: none;"> 

					<button type="button" id="popover" class="btn btn-default" style="display: none;" data-container="body" data-toggle="popover" data-placement="bottom" data-content="You are looking at a visualization of campaign contributions for the Member of Congress shown on the left.  First you'll see the distribution how much the Member of Congress recieved from Political Action Committess (PACs) v. Individual donors.  Hover on a node to see more information and click on the nodes to follow the trail - the end will show the Top 10 Individual or PAC contributors.">
					  What am I seeing?
					</button>

		</div>
		
		<div class="row" id="footer">
			<div class="col-md-12">
    			Created by Corey Shott. Hackbright Academy Summer 2015

    			<!-- Large modal button -->
				<button type="button" id="info_button" class="btn btn-default" data-toggle="modal" data-target=".modal-info">Click for info on data</button>

    		</div>
		
		</div>
	</div>
</div>

	<div class="modal fade modal-info" role="dialog" aria-labelledby="gridSystemModalLabel">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="gridSystemModalLabel">Learn about the data used on this site</h4>
		      </div>
		      <div class="modal-body">
		      	Congressional Money Trail utilizes congressional campaign data from the Center for Responsive Politics (OpenSecrets.org).  Contribution figures are based on totals since 1994 and amounts vary depending on how long a Member of Congress has been in office.  

		      		<img src="/static/img/opensecrets_databy250x88.gif" ref="http://www.opensecrets.org"></img>
		      
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

		      </div>
		    </div>/<!-- .modal-content -->
		  </div>/ <!-- .modal-dialog -->
		</div> <!-- /.modal -->
</div>
<script>

$('#myModal').modal("toggle");

//list possible representatives only after choose state.  
$("#state_pick").change("state_value", showLegislators);
$("#state_pick").change("state_value", function () {
	$("#noMember").hide();
})

// bind showing the TrailMapTree function call to the event named show map that is called after member choice is submitted (below)
$("#map_viz").bind("showMap", showTrailMapTree);

// send member_id to route that will send back info for member_profile NOT PICKING UP FORMS ANYMORE
$("form.repsDistrict").on("submit", function (evt) {

	evt.preventDefault();

	member = {'member': $('select.member_choice option:selected').val()};


	$.post("/trail_map", member, function (result){

		// show the map visualization div and trigger the function call to d3 j.s. of TrailMapTree
		$("#map_viz").show('slow', function () {

			 $(this).trigger('showMap');
		});

		$("#legislators_display").hide();
		$("#state_pick").hide();
		$("#pick_by_address").hide();
		$("#your_district_reps").hide();
		$("#new_choice").show();
		$(".forms").append(result);
		$('#popover').show();

	});
});

$("#new_choice").on("click", function (evt){
	$("#map_viz").empty();
	$("#state_pick").show();
	$('#state_pick').find('option:first').attr('selected', 'selected');
	$("#pick_by_address").show();
	$("#new_choice").hide();
	$("#member_profile").remove();
	$("#popover").hide();
});

$('#popover').popover('hide');
$('#popover').on('click', function() {
	$('#popover').popover('toggle');
 });

</script>


{% endblock %}